/**
 * Coded by Mahmoud Eskandari
 * Email  : info@webafrooz.com
 * Website: http://webafrooz.com
 *
 * Webafrooz Web Development Group co.
 * License: MIT
 *
 * Bill Types:
 * 1: آب (Water)
 * 2: برق (Electricity)
 * 3: گاز (Gas)
 * 4: تلفن ثابت (Landline)
 * 5: موبایل (Mobile)
 * 6: شهرداری (Municipality)
 */

function IranBill(billNumber, paymentId) {
  const WEIGHTS = [2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3, 4, 5, 6, 7, 2, 3];

  if (typeof billNumber !== 'string' || billNumber.length !== 13) return [-1];
  if (typeof paymentId !== 'string' || paymentId.length < 7) return [-2];

  const paddedPaymentId = paymentId.padStart(13, '0');

  const billDigits = [...billNumber].map(Number);
  const paymentDigits = [...paddedPaymentId].map(Number);

  const type = billDigits[11];

  const reverse = arr => [...arr].reverse();

  const calculateChecksum = (digits, offset, length) => {
    let sum = 0;
    for (let i = 0; i < length; i++) {
      sum += digits[i + offset] * WEIGHTS[i];
    }
    const mod = 11 - (sum % 11);
    return mod > 9 ? 0 : mod;
  };

  const reversedBill = reverse(billDigits);
  const reversedPayment = reverse(paymentDigits);

  const billChecksum = calculateChecksum(reversedBill, 1, 12);
  if (billChecksum !== reversedBill[0]) return [-1];

  const paymentChecksum = calculateChecksum(reversedPayment, 2, 11);
  if (paymentChecksum !== reversedPayment[1]) return [-2];

  const finalDigits = [...billNumber + paddedPaymentId.slice(5, 12)].map(Number).reverse();
  const finalChecksum = calculateChecksum(finalDigits, 0, 20);
  if (finalChecksum !== reversedPayment[0]) return [-2];

  const fee = parseInt(paddedPaymentId.slice(0, 8), 10) * 1000;
  if (fee === 0) return [-2];

  return [billNumber, paddedPaymentId, fee, type];
}
 
